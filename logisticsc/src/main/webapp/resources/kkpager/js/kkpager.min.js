/*
  A JavaScript implementation of kkpager paging display controls
  https://github.com/pgkk/kkpager

  Copyright (c) 2013 
  Licensed under the GNU GENERAL PUBLIC LICENSE
 */
var kkpager = {
	//divID  
	pagerid : "kkpager",
	//当前页码
	pno : 1,
	//总页码  
	total : 1,
	//总数据条数 
	totalRecords : 0,
	//是否显示总页数
	isShowTotalPage : true,
	//是否显示总记录数 
	isShowTotalRecords : true,
	//是否显示页码跳转输入框
	isGoPage : true,
	//链接前部 
	hrefFormer : "",
	//链接尾部 
	hrefLatter : "",
	/****链接算法****/
	lang : {
		prePageText : "\u4e0a\u4e00\u9875",
		nextPageText : "\u4e0b\u4e00\u9875",
		totalPageBeforeText : "\u5171",
		totalPageAfterText : "\u9875",
		totalRecordsAfterText : "\u6761\u6570\u636e",
		gopageBeforeText : "\u8f6c\u5230",
		gopageButtonOkText : "\u786e\u5b9a",
		gopageAfterText : "\u9875",
		buttonTipBeforeText : "\u7b2c",
		buttonTipAfterText : "\u9875"
	},
	gopageWrapId : "kkpager_gopage_wrap",
	gopageButtonId : "kkpager_btn_go",
	gopageTextboxId : "kkpager_btn_go_input",
	getLink : function(a) {
		if (a == 1) {
			return this.hrefFormer + this.hrefLatter
		} else {
			return this.hrefFormer + "_" + a + this.hrefLatter
		}
	},
	 //跳转框得到输入焦点时 
	focus_gopage : function() {
		var a = $("#" + this.gopageButtonId);
		$("#" + this.gopageTextboxId).attr("hideFocus", true);
		a.show();
		a.css("left", "0px");
		$("#" + this.gopageWrapId).css("border-color", "#C70007");
		a.animate({
			left : "+=44"
		}, 50, function() {
		})
	},
	
	//跳转框失去输入焦点时 
	blur_gopage : function() {
		var a = this;
		setTimeout(function() {
			var b = $("#" + a.gopageButtonId);
			b.animate({
				left : "-=44"
			}, 100, function() {
				b.css("left", "0px");
				b.hide();
				$("#" + a.gopageWrapId).css("border-color", "#DFDFDF")
			})
		}, 400)
	},
	
	//跳转框页面跳转  
	gopage : function() {
		var a = $("#" + this.gopageTextboxId).val();
		if (isNaN(a)) {
			$("#" + this.gopageTextboxId).val(this.next);
			return

		}
		var b = parseInt(a);
		if (b < 1 || b > this.total) {
			$("#" + this.gopageTextboxId).val(this.next);
			return

		}
		//这里可以按需改window.open  
		window.location = this.getLink(b)
	},
	
	//分页按钮控件初始化  
	init : function(a) {
		//赋值 
		this.pno = isNaN(a.pno) ? 1 : parseInt(a.pno);
		this.total = isNaN(a.total) ? 1 : parseInt(a.total);
		this.totalRecords = isNaN(a.totalRecords) ? 0
				: parseInt(a.totalRecords);
		if (a.pagerid) {
			this.pagerid = a.pagerid
		}
		if (a.gopageWrapId) {
			this.gopageWrapId = a.gopageWrapId
		}
		if (a.gopageButtonId) {
			this.gopageButtonId = a.gopageButtonId
		}
		if (a.gopageTextboxId) {
			this.gopageTextboxId = a.gopageTextboxId
		}
		if (a.isShowTotalPage != undefined) {
			this.isShowTotalPage = a.isShowTotalPage
		}
		if (a.isShowTotalRecords != undefined) {
			this.isShowTotalRecords = a.isShowTotalRecords
		}
		if (a.isGoPage != undefined) {
			this.isGoPage = a.isGoPage
		}
		if (a.lang) {
			for ( var b in a.lang) {
				this.lang[b] = a.lang[b]
			}
		}
		this.hrefFormer = a.hrefFormer || "";
		this.hrefLatter = a.hrefLatter || "";
		if (a.getLink && typeof (a.getLink) == "function") {
			this.getLink = a.getLink
		}
		//验证 
		if (this.pno < 1) {
			this.pno = 1
		}
		this.total = (this.total <= 1) ? 1 : this.total;
		if (this.pno > this.total) {
			this.pno = this.total
		}
		this.prv = (this.pno <= 2) ? 1 : (this.pno - 1);
		this.next = (this.pno >= this.total - 1) ? this.total : (this.pno + 1);
		this.hasPrv = (this.pno > 1);
		this.hasNext = (this.pno < this.total);
		this.inited = true
	},
	//生成分页控件Html 
	generPageHtml : function() {
		if (!this.inited) {
			return

		}
		var j = "", d = "";
		if (this.hasPrv) {
			j = '<a href="' + this.getLink(this.prv) + '" title="'
					+ this.lang.prePageText + '">' + this.lang.prePageText
					+ "</a>"
		} else {
			j = '<span class="disabled">' + this.lang.prePageText + "</span>"
		}
		if (this.hasNext) {
			d = '<a href="' + this.getLink(this.next) + '" title="'
					+ this.lang.nextPageText + '">' + this.lang.nextPageText
					+ "</a>"
		} else {
			d = '<span class="disabled">' + this.lang.nextPageText + "</span>"
		}
		var h = "";
		var a = "<span>...</span>";
		var f = "";
		if (this.isShowTotalPage || this.isShowTotalRecords) {
			f = '<span class="normalsize">' + this.lang.totalPageBeforeText;
			if (this.isShowTotalPage) {
				f += this.total + this.lang.totalPageAfterText;
				if (this.isShowTotalRecords) {
					f += "&nbsp;/&nbsp;"
				}
			}
			if (this.isShowTotalRecords) {
				f += this.totalRecords + this.lang.totalRecordsAfterText
			}
			f += "</span>"
		}
		var g = "";
		if (this.isGoPage) {
			g = "&nbsp;"
					+ this.lang.gopageBeforeText
					+ '<span id="'
					+ this.gopageWrapId
					+ '"><input type="button" id="'
					+ this.gopageButtonId
					+ '" onclick="kkpager.gopage()" value="'
					+ this.lang.gopageButtonOkText
					+ '" /><input type="text" id="'
					+ this.gopageTextboxId
					+ '" onfocus="kkpager.focus_gopage()"     onblur="kkpager.blur_gopage()" value="'
					+ this.next + '" /></span>' + this.lang.gopageAfterText
		}
		//分页处理 
		if (this.total <= 8) {
			for (var e = 1; e <= this.total; e++) {
				if (this.pno == e) {
					h += '<span class="curr">' + e + "</span>"
				} else {
					h += '<a href="' + this.getLink(e) + '" title="'
							+ this.lang.buttonTipBeforeText + e
							+ this.lang.buttonTipAfterText + '">' + e + "</a>"
				}
			}
		} else {
			if (this.pno <= 5) {
				for (var e = 1; e <= 7; e++) {
					if (this.pno == e) {
						h += '<span class="curr">' + e + "</span>"
					} else {
						h += '<a href="' + this.getLink(e) + '" title="'
								+ this.lang.buttonTipBeforeText + e
								+ this.lang.buttonTipAfterText + '">' + e
								+ "</a>"
					}
				}
				h += a
			} else {
				h += '<a href="' + this.getLink(1) + '" title="'
						+ this.lang.buttonTipBeforeText + "1"
						+ this.lang.buttonTipAfterText + '">1</a>';
				h += '<a href="' + this.getLink(2) + '" title="'
						+ this.lang.buttonTipBeforeText + "2"
						+ this.lang.buttonTipAfterText + '">2</a>';
				h += a;
				var b = this.pno - 2;
				var c = this.pno + 2;
				if (c > this.total) {
					c = this.total;
					b = c - 4;
					if (this.pno - b < 2) {
						b = b - 1
					}
				} else {
					if (c + 1 == this.total) {
						c = this.total
					}
				}
				for (var e = b; e <= c; e++) {
					if (this.pno == e) {
						h += '<span class="curr">' + e + "</span>"
					} else {
						h += '<a href="' + this.getLink(e) + '" title="'
								+ this.lang.buttonTipBeforeText + e
								+ this.lang.buttonTipAfterText + '">' + e
								+ "</a>"
					}
				}
				if (c != this.total) {
					h += a
				}
			}
		}
		h = "&nbsp;" + j + h + d + f + g;
		$("#" + this.pagerid).html(h)
	}
};
